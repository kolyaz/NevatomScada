"use strict";(self["webpackChunknevatomscada"]=self["webpackChunknevatomscada"]||[]).push([[369],{2260:(e,o,t)=>{t.d(o,{L:()=>l});const l=e=>{try{if(e)return JSON.parse(e)}catch(o){return!1}return!1}},4606:(e,o,t)=>{t.d(o,{Z:()=>i});var l=t(3673),a=t(2323);const s={class:"AlarmText marquee"},n={id:"alarmText"};function d(e,o,t,d,r,u){return(0,l.wg)(),(0,l.iD)("div",s,[(0,l._)("span",n,(0,a.zw)(e.text),1)])}const r=(0,l.aZ)({name:"AlarmText",data(){return{text:""}},props:{alarms:String},mounted(){this.text=this.alarms},watch:{alarms(){this.text=this.alarms}}});var u=t(3414),p=t(7518),m=t.n(p);r.render=d;const i=r;m()(r,"components",{QItem:u.Z})},7369:(e,o,t)=>{t.r(o),t.d(o,{default:()=>P});var l=t(3673);const a={class:"ModbusConf"},s={class:"modbusTags"},n={class:"q-pa-md"};function d(e,o,t,d,r,u){const p=(0,l.up)("ModbusConf"),m=(0,l.up)("ModbusTags"),i=(0,l.up)("q-btn"),c=(0,l.up)("AlarmText"),w=(0,l.up)("q-page");return(0,l.wg)(),(0,l.j4)(w,{class:""},{default:(0,l.w5)((()=>[(0,l._)("div",a,[(0,l.Wm)(p,{rows:r.conf},null,8,["rows"])]),(0,l._)("div",s,[(0,l.Wm)(m,{rows:r.tags},null,8,["rows"])]),(0,l._)("div",n,[(0,l.Wm)(i,{class:"q-ml-sm btn text-black",color:"warning","icon-right":"save",label:"Сохранить настройки","no-caps":"",onClick:u.setModbusSettings},null,8,["onClick"])]),(0,l._)("div",null,[(0,l.Wm)(c,{alarms:r.alarms},null,8,["alarms"])])])),_:1})}var r=t(4606),u=t(2260),p=t(8825),m=t(2323);const i={class:"q-pa-md"},c={class:"text-pre-wrap"};function w(e,o,t,a,s,n){const d=(0,l.up)("q-btn"),r=(0,l.up)("q-input"),u=(0,l.up)("q-popup-edit"),p=(0,l.up)("q-td"),w=(0,l.up)("q-select"),b=(0,l.up)("q-tr"),V=(0,l.up)("q-table");return(0,l.wg)(),(0,l.iD)("div",i,[(0,l.Wm)(V,{title:"Карта Modbus переменных",rows:t.rows,columns:a.columns,"row-key":"name","binary-state-sort":"","rows-per-page-label":"Записей на страницу"},{"top-right":(0,l.w5)((()=>[(0,l.Wm)(d,{class:"q-ml-sm",color:"secondary","icon-right":"archive",label:"Экспорт в csv","no-caps":"",onClick:n.exportTable},null,8,["onClick"])])),body:(0,l.w5)((e=>[(0,l.Wm)(b,{props:e},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{key:"name",props:e},{default:(0,l.w5)((()=>[(0,l.Uk)((0,m.zw)(e.row.name)+" ",1),(0,l.Wm)(u,{modelValue:e.row.name,"onUpdate:modelValue":o=>e.row.name=o},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{modelValue:e.row.name,"onUpdate:modelValue":o=>e.row.name=o,dense:"",autofocus:"",counter:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"]),(0,l.Wm)(p,{key:"desc",props:e},{default:(0,l.w5)((()=>[(0,l.Uk)((0,m.zw)(e.row.desc)+" ",1),(0,l.Wm)(u,{modelValue:e.row.desc,"onUpdate:modelValue":o=>e.row.desc=o,title:"Обновить название",buttons:"","label-set":"Сохранить","label-cancel":"Выйти"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{type:"textarea",modelValue:e.row.desc,"onUpdate:modelValue":o=>e.row.desc=o,dense:"",autofocus:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"]),(0,l.Wm)(p,{key:"reg",props:e},{default:(0,l.w5)((()=>[(0,l._)("div",c,(0,m.zw)(e.row.reg),1),(0,l.Wm)(u,{modelValue:e.row.reg,"onUpdate:modelValue":o=>e.row.reg=o,buttons:"","label-set":"Сохранить","label-cancel":"Выйти"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{type:"number",modelValue:e.row.reg,"onUpdate:modelValue":o=>e.row.reg=o,dense:"",autofocus:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"]),(0,l.Wm)(p,{key:"type",props:e},{default:(0,l.w5)((()=>[(0,l.Uk)((0,m.zw)(e.row.type)+" ",1),(0,l.Wm)(u,{modelValue:e.row.type,"onUpdate:modelValue":o=>e.row.type=o,title:"Изменить тип",buttons:"",persistent:"","label-set":"Сохранить","label-cancel":"Выйти"},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{modelValue:e.row.type,"onUpdate:modelValue":o=>e.row.type=o,options:a.options,label:"Тип данных"},null,8,["modelValue","onUpdate:modelValue","options"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])}t(7280);var b=t(2841);function V(e,o){let t=void 0!==o?o(e):e;return t=void 0===t||null===t?"":String(t),t=t.split('"').join('""'),`"${t}"`}const f=[{name:"name",required:!0,label:"Наименование тэга ",align:"left",field:e=>e.name,format:e=>`${e}`,sortable:!0},{name:"desc",align:"center",label:"Наименование функции",field:"desc",sortable:!0},{name:"reg",label:"Адрес регистра",field:"reg",sortable:!0},{name:"type",label:"Тип данных",field:"type",sortable:!0}],g={data(){return{}},methods:{exportTable(){const e=(0,p.Z)(),o=[this.columns.map((e=>V(e.label)))].concat(this.rows.map((e=>this.columns.map((o=>V("function"===typeof o.field?o.field(e):e[void 0===o.field?o.name:o.field],o.format))).join(",")))).join("\r\n"),t=(0,b.Z)("table-export.csv",o,"text/csv");!0!==t&&e.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}},props:{rows:Array},mounted(){},setup(){return{columns:f,options:["int","float","long"]}}};var U=t(6429),h=t(8240),y=t(8186),W=t(3884),k=t(1289),_=t(4842),v=t(8516),M=t(7518),S=t.n(M);g.render=w;const q=g;S()(g,"components",{QTable:U.Z,QBtn:h.Z,QTr:y.Z,QTd:W.Z,QPopupEdit:k.Z,QInput:_.Z,QSelect:v.Z});const Z={class:"q-pa-md"},T={class:"text-pre-wrap"};function x(e,o,t,a,s,n){const d=(0,l.up)("q-select"),r=(0,l.up)("q-popup-edit"),u=(0,l.up)("q-td"),p=(0,l.up)("q-input"),i=(0,l.up)("q-tr"),c=(0,l.up)("q-table");return(0,l.wg)(),(0,l.iD)("div",Z,[(0,l.Wm)(c,{title:"Сетевые настройки Modbus",rows:t.rows,columns:a.columns,"row-key":"name","binary-state-sort":"","hide-pagination":""},{body:(0,l.w5)((e=>[(0,l.Wm)(i,{props:e},{default:(0,l.w5)((()=>[(0,l.Wm)(u,{key:"proto",props:e},{default:(0,l.w5)((()=>[(0,l.Uk)((0,m.zw)(e.row.proto)+" ",1),(0,l.Wm)(r,{modelValue:e.row.proto,"onUpdate:modelValue":o=>e.row.proto=o},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{modelValue:e.row.proto,"onUpdate:modelValue":o=>e.row.proto=o,options:a.optionsType,label:"Тип cоединения"},null,8,["modelValue","onUpdate:modelValue","options"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"]),(0,l.Wm)(u,{key:"speed",props:e},{default:(0,l.w5)((()=>[(0,l.Uk)((0,m.zw)(e.row.speed)+" ",1),(0,l.Wm)(r,{modelValue:e.row.speed,"onUpdate:modelValue":o=>e.row.speed=o,title:"Скорость передачи данных"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{modelValue:e.row.speed,"onUpdate:modelValue":o=>e.row.speed=o,options:a.optionsSpeed,label:"скорость"},null,8,["modelValue","onUpdate:modelValue","options"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"]),(0,l.Wm)(u,{key:"mode",props:e},{default:(0,l.w5)((()=>[(0,l._)("div",T,(0,m.zw)(e.row.mode),1),(0,l.Wm)(r,{modelValue:e.row.mode,"onUpdate:modelValue":o=>e.row.mode=o,title:"Режим передачи данных"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{modelValue:e.row.mode,"onUpdate:modelValue":o=>e.row.mode=o,options:a.optionsMode,label:"режим"},null,8,["modelValue","onUpdate:modelValue","options"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"]),(0,l.Wm)(u,{key:"address",props:e},{default:(0,l.w5)((()=>[(0,l.Uk)((0,m.zw)(e.row.address)+" ",1),(0,l.Wm)(r,{modelValue:e.row.address,"onUpdate:modelValue":o=>e.row.address=o,title:"Адрес устройства"},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{modelValue:e.row.address,"onUpdate:modelValue":o=>e.row.address=o,dense:"",autofocus:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"]),(0,l.Wm)(u,{key:"host",props:e},{default:(0,l.w5)((()=>[(0,l.Uk)((0,m.zw)(e.row.connOption.host)+" ",1),(0,l.Wm)(r,{modelValue:e.row.connOption.host,"onUpdate:modelValue":o=>e.row.connOption.host=o,title:"Изменить адрес хоста",mask:"###/##"},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{modelValue:e.row.connOption.host,"onUpdate:modelValue":o=>e.row.connOption.host=o,dense:"",autofocus:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"]),(0,l.Wm)(u,{key:"port",props:e},{default:(0,l.w5)((()=>[(0,l.Uk)((0,m.zw)(e.row.connOption.port)+" ",1),(0,l.Wm)(r,{modelValue:e.row.connOption.port,"onUpdate:modelValue":o=>e.row.connOption.port=o,title:"Изменить номер порта"},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{type:"number",modelValue:e.row.connOption.port,"onUpdate:modelValue":o=>e.row.connOption.port=o,dense:"",autofocus:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])}const Q=[{name:"proto",required:!0,label:"Тип ",align:"left",field:e=>e.proto,format:e=>`${e}`},{name:"speed",align:"center",label:"Скорость",field:"speed"},{name:"mode",label:"Режим",field:"mode"},{name:"address",label:"Адрес",field:"address"},{name:"host",label:"Хост",field:"host"},{name:"port",label:"Порт",field:"port"}],O={data(){return{}},methods:{},props:{rows:Array},setup(){return{columns:Q,optionsType:["RTU","TCP"],optionsSpeed:["1200","2400","4800","9600","19200","38400","115200"],optionsMode:["8N1","8E1","8O1","8N2"]}}};O.render=x;const C=O;S()(O,"components",{QTable:U.Z,QTr:y.Z,QTd:W.Z,QPopupEdit:k.Z,QSelect:v.Z,QInput:_.Z});const z={name:"PageModbusSettings",components:{AlarmText:r.Z,ModbusTags:q,ModbusConf:C},data(){return{modbusData:{},isLoad:!1,alarms:"",conf:[{connOption:{host:"",port:""}}],tags:[{}]}},methods:{getModbusSettings(){const e={getModbusSettings:1,Message:"getModbusSettings"};this.$socket.send(JSON.stringify(e))},setModbusSettings(){this.tags&&this.conf&&(this.modbusData.tags=this.tags,this.modbusData.conf=this.conf,this.$socket.send(JSON.stringify({setModbusSettings:this.modbusData,Message:"setModbusSettings"})))},WebSockets(){const e=(0,p.Z)();try{return this.$socket.onmessage=o=>{const t=(0,u.L)(o.data);t.Message&&e.notify({message:t.Message,color:"secondary",position:"bottom"}),t.errorMessage&&e.notify({message:t.errorMessage,color:"negative",position:"bottom"}),t.modbusSettings&&(this.modbusData=t.modbusSettings,this.conf=t.modbusSettings.conf,this.tags=t.modbusSettings.tags),t.PLCdata.alarms&&(this.alarms=t.PLCdata.alarms)},""}catch(o){return""}}},mounted(){this.WebSockets(),this.getModbusSettings()},setup(){return{}}};var D=t(4379);z.render=d;const P=z;S()(z,"components",{QPage:D.Z,QBtn:h.Z})}}]);