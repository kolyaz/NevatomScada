"use strict";(self["webpackChunknevatomscada"]=self["webpackChunknevatomscada"]||[]).push([[285],{2260:(a,e,t)=>{t.d(e,{L:()=>s});const s=a=>{try{if(a)return JSON.parse(a)}catch(e){return!1}return!1}},4606:(a,e,t)=>{t.d(e,{Z:()=>g});var s=t(3673),n=t(2323);const r={class:"AlarmText marquee"},l={id:"alarmText"};function o(a,e,t,o,i,c){return(0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("span",l,(0,n.zw)(a.text),1)])}const i=(0,s.aZ)({name:"AlarmText",data(){return{text:""}},props:{alarms:String},mounted(){this.text=this.alarms},watch:{alarms(){this.text=this.alarms}}});var c=t(3414),m=t(7518),d=t.n(m);i.render=o;const g=i;d()(i,"components",{QItem:c.Z})},1083:(a,e,t)=>{t.d(e,{Z:()=>d});var s=t(3673);(0,s.dD)("data-v-248d0589");const n={class:"q-pa-md q-gutter-xs spinner"},r={class:"q-gutter-md row items-center"};function l(a,e,t,l,o,i){const c=(0,s.up)("q-spinner-ios");return(0,s.wg)(),(0,s.iD)("div",n,[(0,s._)("div",r,[(0,s.Wm)(c,{color:"orange",size:"5.5em"})])])}(0,s.Cn)();const o={};var i=t(8506),c=t(7518),m=t.n(c);o.render=l,o.__scopeId="data-v-248d0589";const d=o;m()(o,"components",{QSpinnerIos:i.Z})},5285:(a,e,t)=>{t.r(e),t.d(e,{default:()=>A});var s=t(3673);(0,s.dD)("data-v-6cfc0b28");const n={key:1},r={class:""};function l(a,e,t,l,o,i){const c=(0,s.up)("Spinner"),m=(0,s.up)("AlarmPage"),d=(0,s.up)("AlarmText");return(0,s.wg)(),(0,s.iD)(s.HY,null,[a.isLoad?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(c,{key:0})),a.isLoad?((0,s.wg)(),(0,s.iD)("div",n,[(0,s._)("div",r,[(0,s.Wm)(m,{alarmsMagazine:a.alarmsMagazine},null,8,["alarmsMagazine"])]),(0,s._)("div",null,[(0,s.Wm)(d,{alarms:a.alarms},null,8,["alarms"])])])):(0,s.kq)("",!0)],64)}(0,s.Cn)();var o=t(4606),i=t(2260),c=t(8825);(0,s.dD)("data-v-54852dc7");const m={class:"q-pa-md"},d={class:"flex"};function g(a,e,t,n,r,l){const o=(0,s.up)("q-btn"),i=(0,s.up)("q-table");return(0,s.wg)(),(0,s.iD)("div",m,[(0,s.Wm)(i,{"card-class":" text-black",class:"",title:"Журнал аварий",dense:"",rows:r.rows,columns:r.columns,"row-key":"name","rows-per-page-label":"Записей на страницу",pagination:r.pagination,"onUpdate:pagination":e[0]||(e[0]=a=>r.pagination=a)},{"top-right":(0,s.w5)((()=>[(0,s.Wm)(o,{class:"q-ml-sm",color:"secondary","icon-right":"archive",label:"Экспорт в csv","no-caps":"",onClick:l.exportTable},null,8,["onClick"])])),_:1},8,["rows","columns","pagination"]),(0,s._)("div",d,[(0,s.Wm)(o,{class:"q-ml-sm btn ",color:"warning text-black","icon-right":"restart_alt",label:"Сбросить активные","no-caps":"",onClick:l.resetAlarms},null,8,["onClick"]),(0,s.Wm)(o,{class:"q-ml-sm btn",color:"red","icon-right":"delete",label:"Очистить журнал","no-caps":"",onClick:l.deleteAlarms},null,8,["onClick"])])])}(0,s.Cn)();t(7280);var p=t(2841);function u(a,e){let t=void 0!==e?e(a):a;return t=void 0===t||null===t?"":String(t),t=t.split('"').join('""'),`"${t}"`}const h={name:"AlarmPage",data(){return{q:(0,c.Z)(),pagination:{sortBy:"asc",descending:!1,page:1,rowsPerPage:8},columns:[{name:"name",required:!0,label:"№ id",align:"left",field:a=>a.id,format:a=>`${a}`,sortable:!0},{name:"time",align:"center",label:"Время",field:"time",sortable:!0},{name:"text",align:"left",label:"Наименование аварии",field:"text",sortable:!0}],rows:[{id:"",time:"",text:""}]}},props:{alarmsMagazine:Array},watch:{alarmsMagazine(){this.createTable()}},components:{},methods:{createTable(){this.alarmsMagazine&&(this.rows=this.alarmsMagazine)},exportTable(){const a=[this.columns.map((a=>u(a.label)))].concat(this.rows.map((a=>this.columns.map((e=>u("function"===typeof e.field?e.field(a):a[void 0===e.field?e.name:e.field],e.format))).join(",")))).join("\r\n"),e=(0,p.Z)("table-export.csv",a,"text/csv");!0!==e&&this.q.notify({message:"Нет доступа...",color:"negative",icon:"warning"})},resetAlarms(){this.$socket.send(JSON.stringify({resetAlarms:1,Message:"resetAlarms"}))},deleteAlarms(){this.q.dialog({title:"Очистка журнала",message:"Введите пароль администратора",prompt:{model:"",type:"text",isValid:a=>a.length>1},cancel:{push:!1,label:"Выход"},ok:{push:!1,label:"Очистка"}}).onOk((a=>{if("312"===a)return console.log("access assepted"),void this.$socket.send(JSON.stringify({deleteAlarms:1,Message:"deleteAlarms"}));this.q.notify({message:"Не верный пароль!",color:"negative",position:"bottom"}),console.log("access denied")})).onCancel((()=>{})).onDismiss((()=>{}))}},mounted(){this.createTable()}};var b=t(6429),v=t(8240),f=t(7518),k=t.n(f);h.render=g,h.__scopeId="data-v-54852dc7";const w=h;k()(h,"components",{QTable:b.Z,QBtn:v.Z});var x=t(1083);const M=(0,s.aZ)({name:"AlarmMagazine",data(){return{mount:!1,alarms:"",PLCdata:null,isLoad:!1,alarmsMagazine:[]}},components:{AlarmText:o.Z,AlarmPage:w,Spinner:x.Z},methods:{OnMount(){try{return this.$socket.send(JSON.stringify({getAlarms:1,Message:"getAlarms"})),this.isLoad=!0,!0}catch(a){return this.isLoad=!1,!1}},WebSockets(){const a=(0,c.Z)();try{return this.$socket.onmessage=e=>{const t=(0,i.L)(e.data);t.Message&&t.Message&&a.notify({message:t.Message,color:"secondary",position:"bottom"}),t.alarmsMagazine&&(this.alarmsMagazine=t.alarmsMagazine,console.log(t)),t.PLCdata&&(this.$global.$emit("PLCdata",t.PLCdata),this.PLCdata=t.PLCdata,this.alarms=t.PLCdata.alarms)},""}catch(e){return""}}},watch:{alarms(){}},mounted(){this.OnMount(),this.WebSockets()}});M.render=l,M.__scopeId="data-v-6cfc0b28";const A=M}}]);